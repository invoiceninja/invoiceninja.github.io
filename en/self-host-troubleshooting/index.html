<!DOCTYPE html>
<html lang="en">

<head>
    <title>Free Source Available Invoicing, Expenses &amp; Time-Tracking | Invoice Ninja</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="referrer" content="always">
    <link rel="canonical" href="https://invoiceninja.github.io/en/self-host-troubleshooting">
    <meta name="description" content="The leading free source available online invoicing app for freelancers &amp; businesses. Invoice, accept payments, track expenses, &amp; time-tasks">
    <meta name="docsearch:language" content="en" />
    <meta name="docsearch:version" content="v1.0.1" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <link rel="stylesheet" href="/assets/build/css/main.css?id=2efe3772345fcb6092f53238a2931c53">
    <link rel="stylesheet" href="/assets/build/css/docsearch.min.css?id=7cb95be37902ccc193627d8e95120feb" />
    <link rel="stylesheet" href="/assets/build/css/video-js.css?id=725ac2206fba737ebf9405ec02f91c81" />
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">

    <script src="/assets/build/js/lunr.min.js?id=4b684389f3179bfb6f7048d14e2da4e9"></script>
    <script src="/assets/build/js/video.min.js?id=f7f891a09d5fe7da5b498a117486aca9"></script>
    <script src="/assets/build/js/videojs-dash.min.js?id=a5cb38deff90188bdfd2e8cbe7c95128"></script>

        <script type="text/javascript" src="/en_index.js"></script>
    <script type="text/javascript" src="/en.js"></script>
        <style>
      .search-wrapper {
        /* position: relative; */
        /* display: inline-block; */
        /* max-width: 50%;  */
      }

        .results-list {
        position: absolute;
        background-color: white;
        /* border: 1px solid #ccc; */
        padding: 0;
        margin: 0;
        list-style: none;
        max-height: 400px;
        max-width:800px;
        overflow-y: scroll;
        width: calc(100% - 2px);
        z-index: 10000;
        top: 100%; /* This will pin the dropdown to the bottom of the search input */
        left: auto;
        right: auto;
        border-top-left-radius: 0; 
        border-top-right-radius: 0;
        border-bottom-left-radius: 0.25rem;
        /* /* border-bottom-right-radius: 0.25rem; */
        }

        .results-list li {
        padding: 8px;
        cursor: pointer;
        }

        .results-list li:hover {
        background-color: #eee;
        }
        .result-item {
          padding: 16px;
          cursor: pointer;
          border-bottom: 1px solid #f0f0f0;
        }

        .result-item:last-child {
          border-bottom: none;
        }

        .result-item:hover {
          background-color: #f9f9f9;
        }

        .result-title {
          font-size: 16px;
          font-weight: bold;
          margin-bottom: 4px;
        }

        .result-description {
          font-size: 14px;
          color: #777;
        }

    </style>
 
   <script>

      document.addEventListener('DOMContentLoaded', function () {

      let idx = lunr.Index.load(data);

      const input = document.getElementById('search-input');
      const resultsList = document.getElementById('results-list');

      input.addEventListener('input', function () {
        const query = input.value.toLowerCase().trim();

        const results = idx.search(query);

        // Clear previous results
        resultsList.innerHTML = '';

        if (query === '') {
          resultsList.style.display = 'none';
          return;
        }
        // Populate the dropdown results list
        results.forEach(result => {
        
          const matchedDoc = documents.find(doc => doc.id == result.ref);
        
          const li = document.createElement('li');
          li.className = 'result-item';

          const a = document.createElement('a');
          a.href = matchedDoc.uri;
          a.style.textDecoration = 'none'; // Remove the default underline from the link

          const div = document.createElement('div');
          div.className = 'result-title';
          div.textContent = matchedDoc.title + ' | ' + matchedDoc.sub_title;
          a.appendChild(div);

          const div2 = document.createElement('div');
          div2.className = 'result-description';
          div2.textContent = matchedDoc.body.substring(0, 150) + '...';
          a.appendChild(div2);

          li.appendChild(a);
          resultsList.appendChild(li);

        });

        resultsList.style.display = results.length ? 'block' : 'none';

      });

      // Hide the dropdown results list when clicking outside the search box
      document.addEventListener('click', function (event) {
        if (!event.target.closest('#search-box')) {
          resultsList.style.display = 'none';
        }
      });

      input.addEventListener('keydown', function (e) {
        if (e.key === 'ArrowUp') {
          e.preventDefault(); // Prevent scrolling the page
          selectResult(selectedIndex - 1);
        } else if (e.key === 'ArrowDown') {
          e.preventDefault(); // Prevent scrolling the page
          selectResult(selectedIndex + 1);
        } else if (e.key === 'Enter' && selectedIndex >= 0 && selectedIndex < resultsList.children.length) {
          
          window.location.href = resultsList.children[selectedIndex].children[0].href;
        }
      });

      let selectedIndex = -1;

      function selectResult(index) {
        // Deselect the previously selected item
        if (selectedIndex >= 0 && selectedIndex < resultsList.children.length) {
          resultsList.children[selectedIndex].classList.remove('bg-gray-200');
        }

        selectedIndex = index;

        // Select the new item
        if (selectedIndex >= 0 && selectedIndex < resultsList.children.length) {
          resultsList.children[selectedIndex].classList.add('bg-gray-200');

          // Smoothly scroll to the selected item
          resultsList.children[selectedIndex].scrollIntoView({
            block: 'nearest',
            behavior: 'smooth'
          });
        }
      }


      document.addEventListener('keydown', (e) => {

        if (e.key.toLowerCase() == 'k' && e.ctrlKey) {
              // Add your code here
              
            e.preventDefault(); // Prevent scrolling the page

            console.log("yoyo");

              input.focus();
          }
      });


    });



  </script>

    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/agate.min.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>

    <script>hljs.highlightAll();</script>
</head>

<meta name="locale" content="en">

<nav class="py-4 sticky top-0 z-40 lg:z-50 w-full bg-white border-b">
    <div id="navigation-content" class="grid grid-cols-12">
        <div class="float-left pl-4 col-span-2">
            <a href="/en" id=""><img class="object-contain h-10 mt-2	" src="/assets/images/logo-rounded.png" alt="Invoice Ninja logo" />
            </a>
        </div>
                    <div class="search-wrapper w-full col-span-5 flex justify-center" id="search-box">
                <input type="text" id="search-input" placeholder="Search Invoice Ninja... (Ctrl K)" class="h-14 text-lg focus:outline-none rounded-mdsm:max-w-xs">
                <ul id="results-list" class="results-list"></ul>
            </div>
            <!-- <input type="text" placeholder="Quick search ..." id="topSearchBox" data-lpignore="true"
                class="pb-1 border-b hover:border-ninja-blue focus:border-ninja-blue focus:outline-none"> -->
                <div id="right-side-items" class="text-sm w-full col-span-5 flex flex-grow justify-end pr-5">
            <div class="hidden md:hidden lg:block md:space-x-2">
                <span>
                    <a href="/en/user-guide" class="py-2 border-b border-transparent hover:border-ninja-blue">User Guide</a>
                </span>
                <span>
                    <a href="/en/self-host-installation" class="py-2 border-b border-transparent hover:border-ninja-blue">Self Host</a>
                </span>
                <span>
                    <a href="https://api-docs.invoicing.co/" target="_blank" class="py-2 border-b border-transparent hover:border-ninja-blue">API Docs</a>
                </span>
                <span>
                    <a target="_blank" href="https://app.invoicing.co" class="px-5 py-2 border rounded-full hover:border-ninja-blue">‚èª Open App</a>
                </span>
                <span>
                    <select id="locale" onchange="this.options[this.selectedIndex].value && (window.location = '/' + this.options[this.selectedIndex].value);" class="mt-2 rounded-md border-0 py-1.5 pl-1 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        <option value="en">EN</option>
                        <option value="fr_CA">Fr (CA)</option>
                    </select>
                </span>
            </div>
            <div class="flex flex-col lg:hidden">
                <button id="mobile-menu-toggle" class="focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
            </div>

        </div>
    </div>
    <div id="mobile-menu" class="hidden px-4 pt-4 flex flex-col">
        <a href="/en/getting-started" class="py-2 border-b border-transparent hover:border-ninja-blue"> User Guide </a>
        <a href="/en/self-host-installation" class="py-2 border-b border-transparent hover:border-ninja-blue">Self Host</a>
        <a href="https://api-docs.invoicing.co/" target="_blank" class="py-2 border-b border-transparent hover:border-ninja-blue"> API Docs </a>
        <a href="https://app.invoicing.co" target="_blank" class="py-2 border-b border-transparent hover:border-ninja-blue"> ‚èª Open App</a>
        <select id="locale_mobile" onchange="this.options[this.selectedIndex].value && (window.location = '/' + this.options[this.selectedIndex].value);" class="mt-2 rounded-md border-0 py-1.5 pl-3 pr-5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6">
            <option value="en">EN</option>
            <option value="fr_CA">Fr (CA)</option>
        </select>
    </div>
</nav>

<script>
    let element = document.getElementById('locale_mobile');
    element.value = document.querySelector('meta[name="locale"]').content;

    let element2 = document.getElementById('locale');
    element2.value = document.querySelector('meta[name="locale"]').content;
</script>

<body class="font-sans antialiased text-gray-900 bg-white ">
        <div class="hidden top-0 absolute z-40 bg-white w-full h-screen" id="mobile-menu-overlay">
       <div class="p-6 flex items-top justify-between">
           <div>
                                  <div clasS="mb-8">
                       <a class="block hover:text-ninja-blue font-semibold uppercase "
                          href="/en/self-host-installation">Self Host</a>

                       <div class="mt-2">
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/getting-started">Overview</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/self-host-installation">Installation</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/self-host-troubleshooting">Troubleshooting</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/self-host-updating">Updating</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/env-variables">.env Variables</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/self-host-debug-mode">Debug Mode</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/self-host-white-labeling">White Labeling</a>
                                                  </div>
                   </div>
                                  <div clasS="mb-8">
                       <a class="block hover:text-ninja-blue font-semibold uppercase "
                          href="/en/legal/license">Legal</a>

                       <div class="mt-2">
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/license">License</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/terms_of_service">Terms of Service</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/data_privacy">Data Privacy</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/self_hosting_data">Selfhost Data Privacy</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/self_hosting_terms">Selfhost Terms</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/gdpr">GDPR</a>
                                                  </div>
                   </div>
                          </div>
           <div>
                <button onclick="document.getElementById('mobile-menu-overlay').classList.add('hidden');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
           </div>
       </div>
    </div>

    <div class="max-w-12xl grid grid-cols-12 py-2 px-2 lg:mx-auto">
        <div class="hidden space-y-6 md:block lg:col-span-2">
            <div class="hidden lg:block fixed mt-2 h-full overflow-y-auto pb-32 pr-16 pl-4">
                                    <div clasS="mb-8">
                        <a class="block hover:text-ninja-blue font-semibold uppercase "
                          href="/en/self-host-installation">Self Host</a>


                        <div class="mt-2">
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/getting-started">Overview</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/self-host-installation">Installation</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/self-host-troubleshooting">Troubleshooting</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/self-host-updating">Updating</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/env-variables">.env Variables</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/self-host-debug-mode">Debug Mode</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/self-host-white-labeling">White Labeling</a>
                                                    </div>
                    </div>
                                    <div clasS="mb-8">
                        <a class="block hover:text-ninja-blue font-semibold uppercase "
                          href="/en/legal/license">Legal</a>


                        <div class="mt-2">
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/license">License</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/terms_of_service">Terms of Service</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/data_privacy">Data Privacy</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/self_hosting_data">Selfhost Data Privacy</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/self_hosting_terms">Selfhost Terms</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                  href="/en/legal/gdpr">GDPR</a>
                                                    </div>
                    </div>
                            </div>
        </div> <!-- End of sidebar -->

        <div class="col-span-12 md:col-span-8 prose mx-auto max-w-max" id="page-content">
            <div class="block lg:hidden flex flex-col mb-4 lg:mb-0">
                <button onclick="document.getElementById('mobile-menu-overlay').classList.remove('hidden');">&#8592; Documentation</button>
            </div>

            <h1>Self Host Troubleshooting</h1>

<h3>General Troubleshooting Steps</h3>

<p>If you're experiencing issues with your self-hosted Invoice Ninja instance, follow these general troubleshooting steps before diving into the specific sections:</p>

<ol>
<li>Verify that you meet the <a href="https://invoiceninja.github.io/en/self-host-installation/#server-requirements">minimum system requirements</a>.</li>
<li>Consult the <a href="https://forum.invoiceninja.com/">Invoice Ninja forum</a> for community support.</li>
<li>Examine the logs for error messages. You can find the logs in the <code>storage/logs</code> directory.</li>
</ol>

<h2>Incomplete / Unsuccessful in app updates</h2>

<p>If you application failed to update to the latest installation there are several reasons why this may happen:</p>

<ol>
<li>Timeout: Your system timed out during the upgrade process</li>
<li>System requirements may have changed. Prior to upgrading if the version is changing its minor release variable (v5.XXX.1) then you should check the system requirements / release notes to ensure your system is prepared prior to the upgrade. You may need to add a PHP extension or there may be a change to the minimum PHP version required. Patch versions (v5.10.XXX) do not require have any changes to system requirements.</li>
</ol>

<p>In order to recover from a failed/incomplete update, you may attempt to run the self update again within the application else you will want to follow these steps:</p>

<ol>
<li>Navigate to the releases page on <a href="https://github.com/invoiceninja/invoiceninja/releases">Github</a></li>
<li>Download the file labelled invoiceninja.tar</li>
<li>Unpack this file and overwrite your existing file structure</li>
<li><p>Then either of these two steps:
a) From the command line at the project root:</p>

<pre><code class="language-bash">composer i -o --no-dev
php artisan migrate
php artisan optimize:clear
</code></pre>

<p>b) From a browser window</p>

<p>https://yourdomain.com/update?secret=UPDATE_SECRET_VALUE_FROM_ENV_FILE</p></li>
</ol>

<h3>ERROR: Target class [view] does not exist</h3>

<p>This error can usually be resolved by deleting the contents of the bootstrap/cache folder.</p>

<h2>Downgrading to a Specific Version</h2>

<p>If you need to downgrade your Invoice Ninja installation to a specific version, follow the steps below. Ensure you have sufficient backups and preparation to avoid data loss or service interruption.</p>

<h3>Step 1: Backup Your Installation</h3>

<h4>1.1 Backup Your <code>.env</code> File</h4>

<p>The <code>.env</code> file contains critical configuration for your installation. Make a copy of it:</p>

<p>NB! change directory to your Invoice Ninja root folder</p>

<pre><code class="language-bash">cd /var/www/invoiceninja
</code></pre>

<p>NB! Make sure to replace {youraccount} with your user folder</p>

<pre><code class="language-bash">cp .env /home/{youraccount}/invoice-ninja-env-backup-YYYY-MM-DD
</code></pre>

<h4>1.2 Backup Your Database</h4>

<p>Use your preferred database management tool to create a backup. Many tutorials are available online based on your specific database setup (e.g., MySQL, PostgreSQL).</p>

<h4>1.3 Backup Your Root Folder</h4>

<p>For complete recovery, back up your Invoice Ninja root folder:</p>

<p>NB! Make sure to replace {youraccount} with your user folder</p>

<pre><code class="language-bash">tar -pzcf /home/{youraccount}/invoiceninja-YYYY-MM-DD.tar.gz /var/www/invoiceninja
</code></pre>

<h3>Step 2: Download the Target Version</h3>

<p>Navigate to the <a href="https://github.com/invoiceninja/invoiceninja/releases">Invoice Ninja Releases Page</a> and identify the version you wish to downgrade to. Download the <code>invoiceninja.tar</code> file for that version into the root of your Invoice Ninja folder:</p>

<p>NB! change directory to your Invoice Ninja root folder</p>

<pre><code class="language-bash">cd /var/www/invoiceninja 
</code></pre>

<pre><code class="language-bash">wget https://github.com/invoiceninja/invoiceninja/releases/download/v5.XX.XX/invoiceninja.tar
</code></pre>

<h3>Step 3: Extract the Files</h3>

<p>Extract the downloaded archive, ensuring it overwrites the existing files:</p>

<p>NB! Make sure to replace www-data with your web user</p>

<pre><code class="language-bash">sudo -u www-data tar -xf invoiceninja.tar 
</code></pre>

<h3>Step 4: Clear Caches</h3>

<p>Run the following commands to clear caches and optimize the application:</p>

<p>NB! Make sure to replace www-data with your web user</p>

<pre><code class="language-bash">sudo -u www-data php artisan cache:clear
sudo -u www-data php artisan view:clear
sudo -u www-data php artisan config:clear
sudo -u www-data php artisan optimize:clear
sudo -u www-data composer dump-autoload
</code></pre>

<h3>Step 5: Clean Up</h3>

<p>Delete the downloaded <code>invoiceninja.tar</code> file to keep your installation tidy:</p>

<pre><code class="language-bash">cd /var/www/invoiceninja
</code></pre>

<pre><code class="language-bash">rm -f invoiceninja.tar
</code></pre>

<h3>Step 6: Verify the Installation</h3>

<p>Access your Invoice Ninja installation through the browser to ensure it is functioning correctly. If errors occur, follow these steps:</p>

<ol>
<li><p>Delete the Invoice Ninja folder:</p>

<pre><code class="language-bash">rm -rf /var/www/invoiceninja
</code></pre></li>
<li><p>Restore from your backups:</p>

<ul>
<li>Extract your root folder backup.</li>
</ul>

<pre><code class="language-bash">tar -zxf /home/{youraccount}/invoiceninja-YYYY-MM-DD.tar.gz -C /
</code></pre></li>
</ol>

<ul>
<li>Restore your database backup.</li>
</ul>

<h3>Notes</h3>

<ul>
<li>Ensure that the target version‚Äôs system requirements match your server‚Äôs configuration.</li>
<li>If you encounter permission issues, verify that the <code>www-data</code> user (or equivalent web server user) has the correct access to your installation directory.</li>
<li>For additional help, consult the community forums.</li>
</ul>

<h2>SQLSTATE[42S22]: Column not found:</h2>

<p>If you see in your error logs a message such as "Column not found" this indicates that your migrations are not up to date and need to be run there are two ways to force the migrations to run:</p>

<ol>
<li>http://yourdomain.com/update?secret=insert_your_UPDATE_SECRET_variable_here</li>
<li>From the project root run the following command:</li>
</ol>

<pre><code class="language-bash"><br />php artisan migrate

</code></pre>

<h2>Cron not running / Queue not running</h2>

<p><div class="p-5 bg-gray-200 border-l-4 border-red-500">
    <span>It can take up to an hour for the red warning triangle to disappear after correctly configuring your Cron.</p>

<p>After making any changes to your cron setup you'll want to force a recheck of the cron setting. To do this navigate to http://url/update?secret=</span>
</div></p>

<p>If you are faced with your recurring invoices not firing, or your reminders not sending, then most likely your cron job isn't working. The first thing is to make sure you have your cron jobs configured correctly by following the guide <a href="https://invoiceninja.github.io/en/self-host-installation/#cron-configuration-1">here</a></p>

<p>If you are using shared hosting, then will need to add an additional parameter to the cron command which looks like this:</p>

<pre><code>cd /path/to/root/folder &amp;&amp; /usr/bin/php -d register_argc_argv=On artisan schedule:run &gt;&gt; /dev/null 2&gt;&amp;1
</code></pre>

<p>Please note that on some systems the php location may be different, so confirm with your hosting provider which path to PHP you need to use.</p>

<p>To test your changes, navigate your browser to the update URL which is in the following format:</p>

<pre><code>https://yourdomain.com/update?secret=
</code></pre>

<p>The secret variable is located in your .env file until the key <code>UPDATE_SECRET</code> , this will force a recheck and if the cron is working the red error triangle will disappear.</p>

<h2>PDFs don't appear to be updating</h2>

<p>If you are using Cloudflare, then most likely Cloudflare could be caching your static data. To force cache busting, edit your nginx.conf file and add in the following snippet</p>

<pre><code>location ~* \.pdf$ {
    add_header Cache-Control no-store;
}
</code></pre>

<p>On Apache based servers, open the <a href="https://github.com/invoiceninja/invoiceninja/blob/master/public/.htaccess#L25">/public/.htaccess</a> file and update the mod_headers block</p>

<pre><code class="language-apacheconf">&lt;IfModule mod_headers.c&gt;
    # Blocks Search Engine Indexing
    Header set X-Robots-Tag "noindex, nofollow"

    # Prevents PDF File Caching
    &lt;FilesMatch ".pdf$"&gt;
        Header set Cache-Control no-store
    &lt;/FilesMatch&gt;
&lt;/IfModule&gt;
</code></pre>

<h2>Email not sending</h2>

<p><div class="p-5 bg-gray-200 border-l-4 border-red-500">
    <span>If you are using Gmail - Use an <a href="https://support.google.com/accounts/answer/185833?hl=en">app specific password</a> or ensure you have less secure apps turned on.</span>
</div></p>

<p><div class="p-5 bg-gray-200 border-l-4 border-red-500">
    <span>If you are using Office 365 - You may need to <a href="https://docs.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/authenticated-client-smtp-submission">enable SMTP AUTH</a>.</span>
</div></p>

<p>If you are using gmail smtp relay, then a additional .env variable is required.</p>

<p>For Gmail SMTP Relay also ensure you have configure this service in Google by using the following steps:</p>

<pre><code>Go to [Apps &gt; Google Workspace &gt; Gmail &gt; Routing]
Next to SMTP relay service, click Configure.
Set up the SMTP relay service by following the steps in [SMTP relay: Route outgoing non-Gmail messages through Google]
Then, in your env file, use the following:

Gmail SMTP Relay requires a proper EHLO hostname domain to be sent during the SMTP handshake: [127.0.0.1] doesn‚Äôt cut it anymore. For that, Laravel has to check for a host domain variable and send it along with the handshake request.

MAIL_EHLO_DOMAIN="server.domain.com"
MAIL_MAILER=smtp
MAIL_HOST=smtp-relay.gmail.com 
MAIL_PORT=587
MAIL_USERNAME=xxxx
MAIL_PASSWORD=xxxx
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=xxxx
MAIL_FROM_NAME=xxxx
</code></pre>

<p>You will also want to make sure you do not have any firewall rules which may be blocking access to the Google servers, just in case, ensure the following IP addresses are whitelisted:</p>

<pre><code>142.251.163.28
172.253.63.28
172.253.118.28
74.125.24.28
142.250.114.28
142.250.4.28
142.251.12.28
172.217.194.28
142.250.31.28
142.251.167.28
172.253.115.28
</code></pre>

<p>For more detailed information on Gmail Relay, see this post of our forum by community member charles</p>

<p>https://forum.invoiceninja.com/t/emails-not-sending-yet-another-thread-v5-5-55/12401/9</p>

<h3>Mail Mailer configuration</h3>

<p>The <code>MAIL_MAILER</code> field defines which email driver you wish to use, this could be postmark, mailgun, smtp, log - anything that Laravel 9 supports natively is supported in this app.</p>

<p>If the mail config is correct, the next place to check would be to check the error logs for any errors that are being thrown, the error log is found in <code>storage/logs/laravel.log</code></p>

<p>The final source of information in diagnosing mail troubles is to inspect the <code>System Logs</code> tab in the dashboard of the application, in here we log any messages from the mail server itself which may be instructive as to the cause of your issues.</p>

<p>If you are using the Queue system ie. QUEUE_CONNECTION=database then you may also want to check the <code>jobs</code> table in the database, there should be <em>no</em> records in that table... If there are records in the table it means that your queue is not running and therefore no mail jobs are being processed.</p>

<p>It's possible the emails are sent but are blocked for DNS, SPF, DKIM or other reasons. In these cases emailing a test invoice to <a href="https://mail-tester.com">mail-tester.com</a> can help debug certain problems.</p>

<p>Also, if you see in /storage/logs/invoiceninja.log this line <code>error failed with stream_socket_enable_crypto(): SSL operation failed with code 1. OpenSSL Error messages:
error:14090086:SSL routines:ssl3_get_server_certificate:certificate verify failed</code> then try running <code>yum update</code> on your webserver, it should fix the ca-certificates problem.</p>

<h2>GoDaddy email sending woes</h2>

<p>GoDaddy does not allowing sending via third party <a href="https://my.godaddy.com/help/send-form-mail-using-an-smtp-relay-server-953">SMTP</a> servers. They require sending all email via their own servers. If you need to use GoDaddy, we suggest using a transactional email service such as PostMark to bypass.</p>

<h2>PDF conversion issues.</h2>

<p>We strongly recommend using the built in <a href="https://github.com/beganovich/snappdf">snappdf</a> package which is a highly performant PDF generator based on the headless chrome/chromium binary. This package is perfect for users that have root access to their server and are able to install the required dependencies if needed.</p>

<p>To configure SnapPDF use the following .env vars</p>

<pre><code>PDF_GENERATOR=snappdf
</code></pre>

<p>As of version 5.5.12 we no longer prebundle snappdf in the release files, so if you have a new installation you'll need to manually invoke the download of the chromium binary, from the root of the project run the following:</p>

<pre><code>vendor/bin/snappdf download
</code></pre>

<p><div class="p-5 bg-gray-200 border-l-4 border-red-500">
    <span>If PDF generation is broken after an upgrade, you may need to run the above command again, with the force option.</p>

<p>chmod +x vendor/bin/snappdf
sudo -u www-data vendor/bin/snappdf download --force</p>

<p></span>
</div></p>

<p>Snappdf is also the default PDF engine in our <a href="https://github.com/invoiceninja/dockerfiles">Docker</a> image, so if you prefer a very simple installation please consider our Docker setup as it is very fast to get going!</p>

<p>You can use this command to test Snappdf:</p>

<pre><code>./vendor/bin/snappdf convert --html "

<h1>Hello world</h1>

" test.pdf
</code></pre>

<p>A complete list of required dependencies is available <a href="https://github.com/beganovich/snappdf#headless-chrome-doesnt-launch-on-unix">here</a>.</p>

<p><div class="p-5 bg-gray-200 border-l-4 border-red-500">
    <span>In a recent update, chromium/chrome uses the crashpad handler to write to the users home directory .local .config</p>

<p>When running snappdf as a user such as www-data this users directory - typically /var/www - may not be writable OR the www-data user may not be able to create the .local / .config directories required to support SnapPDF / Chrome.</p>

<p>It is advised to chown the home dir of the www user to ensure that crashpad can write to this temp directory and allow PDFs to be generated.</p>

<p>sudo chown -R www-data:www-data /var/www/.local
  sudo chown -R www-data:www-data /var/www/.config</p>

<p></span>
</div></p>

<p>If you are on shared hosting, snappdf probably will be impossible for you to use as you do not have access to the subsystem to install the required packages. Instead, you will need to use a hosted PDF service, the two that Invoice Ninja v5 supports is <a href="https://phantomjscloud.com/">PhantomJS Cloud</a> and our own hosted PDF generator which can use for <em>free</em> to generate <em>unlimited</em> PDFs.</p>

<h3>Phantom JS</h3>

<p>Phantom JS Cloud is the default PDF engine <a href="https://phantomjscloud.com/">PhantomJS Cloud</a> to generate your PDFs, the default API key that comes with a clean installation will no reliably generate PDFs, to ensure you can generate PDFs you should register for an API key on the phantomjscloud website and use this key in the .env file.</p>

<p>Phantom JS can be toggled on and off by setting the PHANTOMJS_PDF_GENERATOR to either TRUE or FALSE. The following .env variables are available for configuring PhantomJS.</p>

<pre><code>PDF_GENERATOR=phantom
PHANTOMJS_KEY='a-demo-key-with-low-quota-per-ip-address'
PHANTOMJS_SECRET='your-secret-here'
</code></pre>

<p>The <code>PHANTOMJS_SECRET</code> can be any random value, it's used to bypass the client portal password.</p>

<p>If you experience errors with PDF generation, such as <code>500 Server error</code> or <code>Failed to load PDF document</code> or a continuous loading bar, you must get a PhantomJS key <a href="https://dashboard.phantomjscloud.com/dash.html#/signup">here</a>, Replace it with the prefilled key <code>a-demo-key-with-low-quota-per-ip-address</code>.</p>

<p><div class="p-5 bg-gray-200 border-l-4 border-red-500">
    <span>For PhantomJS to work, your Invoice Ninja installation web address must be public; localhost installations or those on private networks won't be able to use PhantomJS Cloud.</span>
</div></p>

<h3>Hosted Invoice Ninja PDF generation</h3>

<p>The default PDF generated as of version 5.5.12 is our hosted platform PDF conversion system. The hosted ninja PDF generator is an offsite PDF generator hosted by Invoice Ninja, which operate similar to PhantomJS. It is important to note that we do not store any information with this service, we simply convert the HTML your system sends into a PDF file which is return on the fly.</p>

<pre><code>PDF_GENERATOR=hosted_ninja
</code></pre>

<h2>Platform specific issues</h2>

<h3>General advice</h3>

<p>When facing errors, first set <code>APP_DEBUG=true</code> in <code>.env</code></p>

<h3>Process has been signaled with signal "5"</h3>

<p>This error message is observed when the queue attempts to perform a action where the queue user does not have the correct permissions. You may see this error if you run command line arguments as a user other than the web user.</p>

<p>This is most commonly see in Invoice Ninja where snappdf has been downloaded from the command line as a regular user, the permissions on the binary may prevent the webuser from executing the chrome binary when generating the PDF.</p>

<p>Always ensure that tasks run on the command line are executed by the web user, on Ubuntu this is typically www-data</p>

<p><div class="p-5 bg-gray-200 border-l-4 border-red-500">
    <span>In a recent update, chromium/chrome uses the crashpad handler to write to the users home directory .local .config</p>

<p>When running snappdf as a user such as www-data this users directory - typically /var/www - may not be writable OR the www-data user may not be able to create the .local / .config directories required to support SnapPDF / Chrome.</p>

<p>It is advised to chown the home dir of the www user to ensure that crashpad can write to this temp directory and allow PDFs to be generated.</span>
</div></p>

<h3>Erroneous data format for unserializing 'Symfony\Component\Routing\CompiledRoute'</h3>

<p><p>The most common cause of this issue is running multiple version of PHP, if the caches are built with a different version of PHP you may see the above error as differing versions of PHP may not be interoperable on the same installation. Ensure you are running the same CLI and Web PHP version to prevent any errors/</p></p>

<h3>Unable to connect to database after installation</h3>

<p><p>You may need to restart the queue like this</p></p>

<pre><code>php artisan queue:restart
</code></pre>

<h3>Nginx: 413 ‚Äì Request Entity Too Large</h3>

<p>This error indicated that the client_max_body_size parameter in NGINX is too small, you will need to edit your nginx config and increase the size</p>

<pre><code>client_max_body_size 100M;
</code></pre>

<h3>Proxy configuration.</h3>

<p>For users that rely on configuring a reverse proxy, please consider this post on our forum which details steps which may assist in configuring a reverse proxy.</p>

<p><a href="https://forum.invoiceninja.com/t/selfhosting-setup-failing/5651/8">Reverse Proxy Invoice Ninja</a></p>

<h3>Problems with migration</h3>

<p>If you are experiencing issues with the migration not running as expected please run through the following checklist:</p>

<ul>
<li>Ensure directories are read/writable by the webuser (ie www-data)</li>
<li>Ensure the cron scheduler is running (and working) - You can verify it is working by inspecting the <code>jobs</code> table in the database, it should be empty</li>
<li>Inspect the log file /storage/logs/laravel.log for further information.</li>
<li>If you are still experiencing issues, turn on advanced logging by adding the following variable to your .env file. <code>EXPANDED_LOGGING=true</code> Then attempt the migration again and afterwards inspect the log file in storage/logs/invoiceninja.log</li>
</ul>

<h3>libatk.so not loading for Google</h3>

<p>Pdf generation will not working using the inbuilt PDF engine without some subsystem dependencies, please consult this resource for the list of necessary libraries for each supported platform <a href="https://github.com/beganovich/snappdf#headless-chrome-doesnt-launch-on-unix">Snappdf required libraries</a></p>

<h3>WebCron configuration</h3>

<p>Some systems do not allow cron configurations, one work around is to use a web cron service which can hit a defined endpoint which executes the scheduler via a GET HTTP request. Invoice Ninja has implemented a small service to allow a webcron service to hit the end point:</p>

<pre><code>https://domain.com/webcron?secret=
</code></pre>

<p>To configure the service, you need to add a .env variable</p>

<pre><code>WEBCRON_SECRET=password
</code></pre>

<h3>Installing in a subdirectory.</h3>

<p>It is possible to install Invoice Ninja in a subdirectory outside the doc root, to enable this you will need to update the .htaccess file (only if you are using the Apache webserver),</p>

<pre><code class="language-php">RewriteRule ^(.*)$ public/$1 [L]
</code></pre>

<p>should be updated to</p>

<pre><code class="language-php">RewriteRule ^(.*)$ subdirectoryname/public/$1 [L]
</code></pre>

<h3>Endless setup loop</h3>

<p>If you are finding that all your pre setup checks are passing however you keep falling back to the setup screen, this could indicate that you are missing the <code>mysql-client</code> library which is needed to perform the initial migration. If you are unable to install this for some reason (ie. XAMPP) then you'll need to run the migrations manually by entering the following at the command prompt</p>

<pre><code>php artisan migrate:fresh --seed 
</code></pre>

<h3>flock() expects parameter 1 to be resource, bool given</h3>

<p>This error is thrown from deep within PHP and indicates a permissions issue - most likely the public/storage and/or storage/ directory is not writable by the web user, depending on your platform, you'll need to run something like:</p>

<pre><code>sudo chown -R www-data:www-data public/storage

sudo find ./ -type d -exec chmod 755 {} \;
</code></pre>

<p>and/or</p>

<pre><code>sudo chown -R www-data:www-data storage/

sudo find ./ -type d -exec chmod 755 {} \;
</code></pre>

<h3>Unresponsive UI</h3>

<p>If for some reason the UI becomes unresponsive, you may need to flush some subsystem configuration and rebuild. It is possible to do this by navigating to the <code>/update?secret=</code>  route, ie. https://invoiceninja.test/update?secret= This will perform a number of system clean ups and may resolve issues resulting from an incomplete upgrade. To protect this route, you are advised to add a .env pararameter <code>UPDATE_SECRET=a_secret_passcode</code> this will restrict the route to users with the UPDATE_SECRET passcode.</p>

<h3>Logo not appearing in the PDF</h3>

<p>It may help to add <code>LOCAL_DOWNLOAD=true</code> to the .env file, this will embed the image in the PDF rather than request it over the network.</p>

<h3>Communication link failure: 1153 Got a packet bigger than 'max_allowed_packet'</h3>

<p>If you are using the database for your queue's then sometimes you may see an error from MySQL</p>

<pre><code>1153 Got a packet bigger than 'max_allowed_packet'
</code></pre>

<p>This indicates the insertion payload is bigger than MySQL is configured to handle! To work around this, you will need to increate the mysql variable</p>

<pre><code>max_allowed_packet
</code></pre>

<p>To a larger value. Sometimes a value of 1024M is required.</p>

<p>It may also be wise to increase the variable</p>

<pre><code>max_connections
</code></pre>

<p>as similar errors can be reported from the DB.</p>

<h3>500 error when editing PDF templates</h3>

<p>There was a <a href="https://forum.invoiceninja.com/t/500-error-when-editing-pdf-invoice-templates-potential-fix/7067">report</a> 
from the user who solved 500 error on their server by disabling ModSecurity.</p>

<h3>500 error when trying to login or edit company details</h3>

<p>Try these steps to fix the 500 server error when trying to login or editing company details</p>

<ol>
<li>Download the latest update from the <a href="https://github.com/invoiceninja/invoiceninja/releases">github releases</a> (not <code>invoiceninja.tar</code> but <code>Source code (zip)</code>)</li>
<li>Upload the zip, extract the files and override them in your /public_html/ (Be careful to not override the .env file or all will be gone)</li>
<li>Login to your root and make sure first of all that all files are owned recursively by the user, ex. <code>sudo chown -R www-data:www-data dir/</code></li>
<li>Run this command <code>cd /home/domain.com/public_html/invoiceninja/ &amp;&amp; php artisan migrate</code> or simply <code>php artisan migrate</code> whatever works for you, select "YES"</li>
<li>If an error occurs like this one</li>
</ol>

<pre><code>PHP Fatal error:  Cannot declare class UpdateDesigns, because the name is already in use in /home/domain.com/public_html/invoiceninja/database/migrations/2021_09_16_115919_update_designs.php on line 0
In 2021_09_16_115919_update_designs.php line n/a: Cannot declare class UpdateDesigns, because the name is already in use
</code></pre>

<p>Delete that file and retry the command until it works and runs properly.</p>

<ol start="6">
<li>Go to https://domain.com/update?secret=x to be sure the update worked, it should load the login screen and work, you should also be able to edit the company details again.</li>
</ol>

<h3>Unresolvable dependency resolving [Parameter #0 [ array $options ]] in class App\Utils\CssInlinerPlugin</h3>

<p>When changes are made to the container this can causes the cache to become stale in the application preventing it from booting.</p>

<p>The solution is to clear the contents of the folder <code>bootstrap/cache</code>, by either manually deleting files or by running <code>/update?secret=</code> which will also delete the contents of this directory.</p>

<h3>Uncaught ErrorException Collection::offsetExists($key)</h3>

<p>This error is observed when the system has Composer v1 installed. Update to Composer 2 using the following command</p>

<pre><code>sudo -H composer self-update
</code></pre>

<h3>file_exists(): open_basedir restriction in effect</h3>

<p>If you aren't able to adjust the open_basedir restrictions the following steps may help:</p>

<ol>
<li>Delete bootstrap/cache/config.php</li>
<li>Delete all log files in storage/logs</li>
</ol>

<h3>I've forgotten my password and cannot reset it, HELP!</h3>

<p>If you have command line access, you can reset your password manually by following the following steps. From the command line, navigate to the project directory and run</p>

<pre><code>php artisan tinker
</code></pre>

<p>Then find the id of the user for the password reset</p>

<pre><code>User::all();
</code></pre>

<p>Retrieve the user</p>

<pre><code>$user = User::find(id_of_user_to_find);
</code></pre>

<p>Now lets reset the password</p>

<p>```
$user->password = Hash::make('password');
$u->save();</p>

            <a href="https://github.com/invoiceninja/invoiceninja.github.io/blob/v5-rework/source/en/self-host-troubleshooting.md"
               class="pt-4 border-t inline-flex items-center w-full block">
                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     class="feather feather-github">
                    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                </svg>
                <span class="ml-2">Want to contribute? Edit this page on GitHub!</span>
            </a>
        </div> <!-- End of main content -->

        <div class="hidden md:block col-span-2 p-4">
            <div class="fixed overflow-y-auto pr-4 h-full pl-4 pb-32 text-sm" id="toc-container">
                <!-- Placeholder for table of contents -->
                <span class="text-sm uppercase block mb-3 text-ninja-blue">On this page</span>
            </div>
        </div>
    </div>
        <script src="/assets/build/js/main.js?id=5d8f1025c2be8c2903a2ea7ba7775489"></script>

    <script>
        document.getElementById('mobile-menu-toggle').addEventListener('click', () => {
            let mobileMenu = document.getElementById('mobile-menu');

            if (mobileMenu.classList.contains('hidden')) {
                return mobileMenu.classList.remove('hidden');
            }

            return mobileMenu.classList.add('hidden');
        });
    </script>

    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script type="text/javascript">
        docsearch({
            apiKey: '4816218e8381d5a17beacd84823e9ea3',
            indexName: 'invoiceninja',
            inputSelector: '#topSearchBox',
            debug: false,
            searchParameters: {
                facetFilters: ['language:en'],
            },
        });
    </script>
        <script type="text/javascript">
        docsearch({
            apiKey: '4816218e8381d5a17beacd84823e9ea3',
            indexName: 'invoiceninja',
            inputSelector: '#indexSearchBox',
            debug: false,
            searchParameters: {
                facetFilters: ['language:en'],
            },
        });
    </script> -->

<style>
.video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.video_container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 56.25%;
}

</style>
</body>

</html>
